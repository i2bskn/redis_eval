#!/usr/bin/env ruby

require "bundler/setup"
require "redis_eval"

if url = ENV["REDIS_EVAL_URL"]
  RedisEval.config.redis_options = { url: url }
end

lua_script = ARGV[0] || (raise ArgumentError, "Unknown script path")
key_count = ARGV[1].to_i
argv = ARGV[2..-1] || []

raise ArgumentError, "Not enough KEYS of argument." if key_count > argv.size
keys = argv.shift(key_count)

script = RedisEval.build(lua_script)
p script.execute(keys, argv)
